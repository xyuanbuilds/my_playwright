# Claude Code + Playwriter + 检测工具 整合指南

本文档介绍如何将三个强大工具有机结合，实现更高效的网站自动化检测工作流。

## 三大工具概览

### 1. 本项目的检测工具
- **功能**: 批量检测网站性能、资源完整性
- **特点**: 自动化、结构化报告、按日期组织
- **使用**: `pnpm run monitor`

### 2. Playwriter MCP 服务器
- **功能**: 在真实 Chrome 浏览器中执行 Playwright 代码
- **特点**: 保持登录状态、可视化调试、支持扩展
- **使用**: 通过 Claude Code 对话调用

### 3. Claude Code
- **功能**: AI 驱动的开发助手
- **特点**: 理解需求、生成代码、执行任务
- **集成**: MCP 协议连接 Playwriter

## 协同工作流

```
┌─────────────────────────────────────────────────────────┐
│                     您的工作流程                         │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
         ┌──────────────────────────────────────┐
         │  1. 与 Claude Code 对话描述需求       │
         │     "检测这些网址的加载性能"          │
         └──────────────────┬───────────────────┘
                            │
                            ▼
         ┌──────────────────────────────────────┐
         │  2. Claude 分析并选择合适的工具       │
         │     - 简单检测 → 使用本地检测工具    │
         │     - 需要登录 → 使用 Playwriter     │
         │     - 复杂场景 → 结合两者            │
         └──────────────────┬───────────────────┘
                            │
                ┌───────────┴───────────┐
                │                       │
                ▼                       ▼
    ┌─────────────────────┐   ┌─────────────────────┐
    │  检测工具执行        │   │  Playwriter 执行     │
    │  (无头浏览器)        │   │  (真实浏览器)        │
    │                     │   │                     │
    │  • 快速批量         │   │  • 保持登录         │
    │  • 自动化报告       │   │  • 可视化调试       │
    │  • 性能指标         │   │  • 交互式操作       │
    └─────────────────────┘   └─────────────────────┘
                │                       │
                └───────────┬───────────┘
                            │
                            ▼
         ┌──────────────────────────────────────┐
         │  3. Claude 整合结果并生成报告         │
         └──────────────────────────────────────┘
```

## 使用场景示例

### 场景 1: 公开网站批量检测

**需求**: 检测多个公开网站的性能

**推荐方案**: 使用本地检测工具

**操作步骤**:
```bash
pnpm run monitor
# 输入网址列表
# 自动生成 JSON 报告和截图
```

**为什么不用 Playwriter**:
- 公开网站不需要登录
- 批量检测更快速
- 自动化程度更高

---

### 场景 2: 需要登录的内部系统检测

**需求**: 检测公司内部系统，需要登录后才能访问

**推荐方案**: 使用 Playwriter

**与 Claude 对话**:
```
用户: "我需要检测公司内部系统 https://internal.company.com 的加载性能，
      但需要先登录。请帮我：
      1. 在真实浏览器中打开登录页
      2. 让我手动登录
      3. 然后自动检测性能并截图"

Claude: 好的，我会使用 Playwriter 在您的 Chrome 浏览器中执行。
        [使用 Playwriter MCP 执行]
```

**优势**:
- 保持登录状态，无需每次输入密码
- 可以手动处理验证码
- 支持公司的 VPN 或代理设置

---

### 场景 3: 复杂的交互式测试

**需求**: 测试包含复杂交互的单页应用 (SPA)

**推荐方案**: Playwriter + Claude Code 协作

**与 Claude 对话**:
```
用户: "帮我测试这个 React 应用的购物流程：
      1. 搜索商品 'iPhone'
      2. 点击第一个结果
      3. 添加到购物车
      4. 检查购物车页面是否正确显示
      5. 记录每一步的加载时间"

Claude: 我会使用 Playwriter 逐步执行并收集性能数据。
        [编写并执行测试脚本]
        [收集性能指标]
        [生成结构化报告]
```

**Claude 可以**:
- 自动生成测试脚本
- 处理异步加载
- 智能等待元素出现
- 收集详细的性能数据

---

### 场景 4: 对比测试 (A/B Testing)

**需求**: 对比新旧版本的性能差异

**推荐方案**: 结合两种工具

**工作流程**:

1. **基准测试** (使用本地工具):
   ```bash
   pnpm run monitor
   # 检测旧版本 10 次
   # 生成基准数据
   ```

2. **新版本测试** (使用 Playwriter):
   ```
   用户: "用 Playwriter 打开新版本网站，执行相同的操作，
         并与之前的基准数据对比"

   Claude: [使用 Playwriter 执行]
           [对比性能差异]
           [生成对比报告]
   ```

3. **结果分析**:
   Claude 自动分析两组数据的差异，生成可视化报告。

---

### 场景 5: 调试失败的检测

**需求**: 检测工具报告某个网址检测失败，需要调查原因

**推荐方案**: Playwriter 可视化调试

**与 Claude 对话**:
```
用户: "这个网址 https://example.com 在自动检测时失败了，
      错误信息是 'Navigation timeout'。
      帮我在真实浏览器中重现这个问题。"

Claude: 我会用 Playwriter 打开这个网址，让您看到实际发生了什么。
        [在真实浏览器中执行]
        [显示网络请求]
        [检查控制台错误]
```

**优势**:
- 实时观察加载过程
- 检查网络请求
- 查看控制台错误
- 手动交互调试

---

## 最佳实践

### 1. 选择合适的工具

| 场景 | 推荐工具 | 原因 |
|------|---------|------|
| 批量检测公开网站 | 本地检测工具 | 快速、自动化 |
| 需要登录的网站 | Playwriter | 保持会话 |
| 复杂交互流程 | Playwriter + Claude | 智能处理 |
| 定期监控 | 本地检测工具 | 易于自动化 |
| 调试问题 | Playwriter | 可视化 |

### 2. 数据管理

**使用本地检测工具**:
- 自动按日期组织报告
- 结构化 JSON 便于分析
- 截图自动保存

**使用 Playwriter**:
- 让 Claude 帮您整理结果
- 要求生成特定格式的报告
- 结合本地工具的报告格式

### 3. 与 Claude 协作的技巧

**清晰描述需求**:
```
✅ 好的请求:
"检测这 5 个网址的加载性能，记录 TTFB、FCP 和 LCP，
生成 JSON 报告，并找出最慢的那个。"

❌ 模糊的请求:
"帮我测试一下这些网站"
```

**充分利用 Claude 的能力**:
- 让它分析检测结果
- 让它识别性能瓶颈
- 让它生成优化建议
- 让它对比历史数据

### 4. 自动化工作流

**日常监控** (使用 cron):
```bash
# 每天早上 8 点运行检测
0 8 * * * cd /path/to/project && pnpm run monitor << EOF
https://example.com
https://another.com

Y
EOF
```

**持续集成** (CI/CD):
```yaml
# .github/workflows/monitor.yml
name: Daily Website Check
on:
  schedule:
    - cron: '0 0 * * *'
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: pnpm install
      - run: pnpm run monitor < urls.txt
      - uses: actions/upload-artifact@v2
        with:
          name: detection-reports
          path: detection-records/
```

## 实战示例

### 完整的检测流程

假设您需要监控一个电商网站的性能：

1. **定期自动检测** (每小时):
   ```bash
   # 使用本地工具批量检测
   pnpm run monitor
   ```

2. **异常调查** (发现问题时):
   ```
   与 Claude 对话:
   "昨天晚上 8 点的检测显示加载时间突然增加了 3 秒，
    帮我用 Playwriter 重现问题并找出原因。"
   ```

3. **性能优化验证** (部署新版本后):
   ```
   与 Claude 对话:
   "对比部署前后的性能数据，生成详细的改进报告。"
   ```

4. **报告生成**:
   ```
   与 Claude 对话:
   "根据本周的检测数据，生成周报，包括：
    - 平均加载时间趋势
    - 失败率统计
    - 性能最差的时间段
    - 改进建议"
   ```

## 扩展建议

### 1. 创建自定义脚本

让 Claude 帮您创建针对特定需求的脚本：

```typescript
// scripts/check-with-login.ts
// Claude 可以生成这样的脚本，结合两种工具的优势
```

### 2. 集成到 CI/CD

将检测结果作为部署的质量门禁：

```javascript
// 性能阈值检查
if (avgLoadTime > 3000) {
  throw new Error('Performance regression detected');
}
```

### 3. 数据可视化

让 Claude 帮您：
- 分析历史数据
- 生成趋势图
- 识别异常模式
- 提供优化建议

## 总结

通过整合这三个工具，您可以：

✅ **高效**: 自动化处理常规检测
✅ **灵活**: 使用真实浏览器处理复杂场景
✅ **智能**: AI 辅助分析和决策
✅ **可靠**: 结构化报告和历史追踪

**记住**:
- 简单任务用本地工具
- 复杂场景找 Claude + Playwriter
- 充分描述需求让 AI 帮您选择最佳方案

现在开始您的高效自动化检测之旅吧！🚀
